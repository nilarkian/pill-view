{
  "version": 3,
  "sources": ["main.ts", "src/basesTabs.base.ts", "src/leafUtils.ts", "src/types.ts", "src/basesEmbedParser.ts", "src/basesTabs.embed.ts"],
  "sourcesContent": ["// main.ts\r\nimport { Plugin } from \"obsidian\";\r\nimport { injectBasesTabs } from \"./src/basesTabs.base\";\r\nimport { initBasesEmbedTabs } from \"./src/basesTabs.embed\";\r\n\r\nexport default class ViewTabsPlugin extends Plugin {\r\n  observer: MutationObserver | null = null;\r\n\r\n  async onload() {\r\n    // .base files (real Bases views)\r\n    await injectBasesTabs(this.app);\r\n\r\n    // embedded bases inside markdown\r\n    initBasesEmbedTabs(this);\r\n\r\n    this.startObserver();\r\n  }\r\n\r\n  onunload() {\r\n    this.observer?.disconnect();\r\n  }\r\n\r\n  private startObserver() {\r\n    this.observer = new MutationObserver(() => {\r\n      // SAFE: injectBasesTabs is idempotent\r\n      void injectBasesTabs(this.app);\r\n    });\r\n\r\n    this.observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true,\r\n    });\r\n  }\r\n}\r\n", "// basesTabs.ts\r\nimport { App } from \"obsidian\";\r\nimport { parseYaml } from \"obsidian\";\r\nimport { findLeafForBasesView } from \"./leafUtils\";\r\nimport { CONTAINER_CLASS, ROW_CLASS, ACTIVE_CLASS } from \"./types\";\r\n\r\nexport async function injectBasesTabs(app: App) {\r\n  const basesViews = document.querySelectorAll<HTMLElement>(\".bases-view\");\r\n  if (!basesViews.length) return;\r\n\r\n  const file = app.workspace.getActiveFile();\r\n  if (!file || file.extension !== \"base\") return;\r\n\r\n  let viewNames: string[] = [];\r\n  try {\r\n    const raw = await app.vault.read(file);\r\n    const { views } = parseYaml(raw) as {\r\n      views?: { name: string; type: string }[];\r\n    };\r\n    viewNames = views?.map(v => v.name) ?? [];\r\n  } catch {\r\n    return;\r\n  }\r\n\r\n  basesViews.forEach((basesView) => {\r\n      if (basesView.closest(\".cm-embed-block.cm-lang-base\")) return;\r\n    const root = basesView.parentElement;\r\n    if (!root) return;\r\n\r\n    const header = root.querySelector<HTMLElement>(\".bases-header\");\r\n    if (!header) return;\r\n\r\n    // ---- row AFTER header ----\r\n    let row = header.nextElementSibling as HTMLElement | null;\r\n    if (!row || !row.classList.contains(ROW_CLASS)) {\r\n      row = document.createElement(\"div\");\r\n      row.className = `bases-header-row ${ROW_CLASS}`;\r\n      header.after(row);\r\n    }\r\n\r\n    let container =\r\n      row.querySelector<HTMLElement>(`.${CONTAINER_CLASS}`);\r\n      \r\n\r\n    if (!container) {\r\n      container = document.createElement(\"div\");\r\n      container.className = CONTAINER_CLASS;\r\n      row.appendChild(container);\r\n    }\r\n\r\n    const existing = Array.from(container.children).map(\r\n      el => (el as HTMLElement).innerText\r\n    );\r\n\r\n    const same =\r\n      existing.length === viewNames.length &&\r\n      existing.every((n, i) => n === viewNames[i]);\r\n\r\n    if (!same) {\r\n      container.empty();\r\n\r\n      for (const name of viewNames) {\r\n        const btn = document.createElement(\"button\");\r\n        btn.textContent = name;\r\n        btn.className = \"suggestion-item bases-toolbar-menu-item\";\r\n\r\n        btn.addEventListener(\"click\", async () => {\r\n          const leaf = findLeafForBasesView(app, basesView);\r\n          if (!leaf) return;\r\n\r\n          if ((leaf as any).loadIfDeferred) {\r\n            await (leaf as any).loadIfDeferred();\r\n          }\r\n\r\n          const controller = (leaf.view as any)?.controller;\r\n          if (!controller) return;\r\n\r\n          controller.selectView(name);\r\n          updateActive(container!, name);\r\n        });\r\n\r\n        container.appendChild(btn);\r\n      }\r\n    }\r\n\r\n    // sync active state\r\n    const leaf = findLeafForBasesView(app, basesView);\r\n    const controller = (leaf?.view as any)?.controller;\r\n    if (controller?.getActiveView) {\r\n      updateActive(container, controller.getActiveView().name);\r\n    }\r\n  });\r\n}\r\n\r\nfunction updateActive(container: HTMLElement, activeName?: string) {\r\n  Array.from(container.children).forEach((el) => {\r\n    el.classList.toggle(\r\n      ACTIVE_CLASS,\r\n      (el as HTMLElement).innerText === activeName\r\n    );\r\n  });\r\n}", "// leafUtils.ts\r\nimport { WorkspaceLeaf, App } from \"obsidian\";\r\n\r\nexport function findLeafForBasesView(\r\n  app: App,\r\n  el: HTMLElement\r\n): WorkspaceLeaf | null {\r\n  const leaves = app.workspace.getLeavesOfType(\"bases\");\r\n  for (const leaf of leaves) {\r\n    if ((leaf.view as any)?.containerEl === el) return leaf;\r\n  }\r\n  return app.workspace.getMostRecentLeaf();\r\n}", "// types.ts\r\nexport const CONTAINER_CLASS = \"pill-tabs-container\";\r\nexport const ROW_CLASS = \"pill-tabs-row\";\r\nexport const ACTIVE_CLASS = \"is-active\";", "// basesEmbedParser.ts\r\nimport { Plugin, TFile } from \"obsidian\";\r\n\r\n/**\r\n * Reads the markdown file, finds the first ```base block,\r\n * and returns extracted view names.\r\n */\r\nexport async function readBaseViewNames(\r\n  plugin: Plugin,\r\n  sourcePath: string\r\n): Promise<string[] | null> {\r\n  const file = plugin.app.vault.getAbstractFileByPath(sourcePath);\r\n  if (!(file instanceof TFile)) return null;\r\n\r\n  const content = await plugin.app.vault.read(file);\r\n\r\n  const baseBlocks = content.match(/```base[\\s\\S]*?```/g);\r\n  if (!baseBlocks || baseBlocks.length === 0) return null;\r\n\r\n  // For now: first base block only (matches current embed behavior)\r\n  const block = baseBlocks[0];\r\n\r\n  const names = [...block.matchAll(/^\\s*name:\\s*([^\\n]+)/gm)]\r\n\r\n    .map((m) => m[1].trim());\r\n\r\n  return names.length ? names : null;\r\n}\r\n", "// basesTabs.embed.ts\r\nimport { Plugin } from \"obsidian\";\r\nimport { readBaseViewNames } from \"./basesEmbedParser\";\r\n\r\nconst CONTAINER_CLASS = \"pill-tabs-container\";\r\n\r\ntype EmbedWithCache = HTMLElement & {\r\n  _pillViewNames?: string[];\r\n  _basesHeader?: HTMLElement;\r\n};\r\n\r\nlet hideStyleInstalled = false;\r\n\r\nfunction ensureHiddenMenuStyle() {\r\n  if (hideStyleInstalled) return;\r\n  hideStyleInstalled = true;\r\n\r\n  const style = document.createElement(\"style\");\r\n  style.textContent = `\r\n    body.pill-hide-bases-menu .menu.bases-toolbar-views-menu {\r\n      visibility: hidden !important;\r\n      pointer-events: none !important;\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n}\r\n\r\nexport function initBasesEmbedTabs(plugin: Plugin) {\r\n  const observer = new MutationObserver((mutations) => {\r\n    const activeFile = plugin.app.workspace.getActiveFile();\r\n    if (!activeFile) return;\r\n\r\n    for (const m of mutations) {\r\n      for (const node of m.addedNodes) {\r\n        if (!(node instanceof HTMLElement)) continue;\r\n\r\n        // HARD GATE: only Base embeds\r\n        if (\r\n          !node.classList.contains(\"cm-embed-block\") ||\r\n          !node.classList.contains(\"cm-lang-base\")\r\n        ) {\r\n          continue;\r\n        }\r\n\r\n        const embed = node as EmbedWithCache;\r\n\r\n        if (!embed._basesHeader) {\r\n          const header = embed.querySelector(\".bases-header\");\r\n          if (!(header instanceof HTMLElement)) continue;\r\n          embed._basesHeader = header;\r\n        }\r\n\r\n        const header = embed._basesHeader;\r\n\r\n        // Inject tabs once\r\n        if (!embed.querySelector(`.${CONTAINER_CLASS}`)) {\r\n          injectTabs(embed, header);\r\n        }\r\n\r\n        // Load view names once\r\n        if (!embed._pillViewNames) {\r\n          readBaseViewNames(plugin, activeFile.path).then((names) => {\r\n            if (!names) return;\r\n            embed._pillViewNames = names;\r\n            removeTabs(embed);\r\n            injectTabs(embed, header);\r\n          });\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  observer.observe(document.body, { childList: true, subtree: true });\r\n  plugin.register(() => observer.disconnect());\r\n}\r\n\r\nfunction removeTabs(embed: HTMLElement) {\r\n  embed.querySelector(`.${CONTAINER_CLASS}`)?.remove();\r\n}\r\n\r\nfunction injectTabs(embed: EmbedWithCache, header: HTMLElement) {\r\n  if (embed.querySelector(`.${CONTAINER_CLASS}`)) return;\r\n\r\n  const container = document.createElement(\"div\");\r\n  container.className = CONTAINER_CLASS;\r\n\r\n  const names = embed._pillViewNames;\r\n  const count = names?.length ?? 5;\r\n\r\n  for (let i = 0; i < count; i++) {\r\n    const btn = document.createElement(\"button\");\r\n    btn.textContent = names?.[i] ?? `View ${i + 1}`;\r\n    btn.dataset.index = String(i);\r\n    container.appendChild(btn);\r\n  }\r\n\r\n  container.onclick = (e) => {\r\n    const btn = (e.target as HTMLElement)?.closest(\"button\");\r\n    if (!btn) return;\r\n\r\n    const index = Number(btn.dataset.index);\r\n    setActive(container, btn);\r\n    requestAnimationFrame(() => switchEmbedViewByIndex(embed, index));\r\n  };\r\n\r\n  header.after(container);\r\n}\r\n\r\nfunction setActive(container: HTMLElement, active: HTMLElement) {\r\n  container.querySelector(\".is-active\")?.classList.remove(\"is-active\");\r\n  active.classList.add(\"is-active\");\r\n}\r\n\r\nfunction switchEmbedViewByIndex(embed: EmbedWithCache, index: number) {\r\n  const header = embed._basesHeader;\r\n  if (!header) return;\r\n\r\n  const viewButton = header.querySelector<HTMLElement>(\".text-icon-button\");\r\n  if (!viewButton) return;\r\n\r\n  ensureHiddenMenuStyle();\r\n  document.body.classList.add(\"pill-hide-bases-menu\");\r\n\r\n  viewButton.click();\r\n\r\n  requestAnimationFrame(() => {\r\n    const menu = document.querySelector(\r\n      \".menu.bases-toolbar-views-menu\"\r\n    ) as HTMLElement | null;\r\n\r\n    if (!menu) {\r\n      document.body.classList.remove(\"pill-hide-bases-menu\");\r\n      return;\r\n    }\r\n\r\n    const items = menu.querySelectorAll<HTMLElement>(\r\n      \".suggestion-item.bases-toolbar-menu-item\"\r\n      \r\n    );\r\n\r\n    items[index]?.click();\r\n\r\n    requestAnimationFrame(() => {\r\n      document.body.classList.remove(\"pill-hide-bases-menu\");\r\n    });\r\n  });\r\n}\r\n"],
  "mappings": "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",
  "names": ["import_obsidian", "leaf", "controller", "import_obsidian", "CONTAINER_CLASS", "header"]
}
